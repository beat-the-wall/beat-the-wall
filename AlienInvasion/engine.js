!function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,i){var a=(new Date).getTime(),n=Math.max(0,16-(a-t)),s=window.setTimeout(function(){e(a+n)},n);return t=a+n,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var Game=new function(){var t=[];this.initialize=function(t,e,i){if(this.canvas=document.getElementById(t),this.playerOffset=10,this.canvasMultiplier=1,this.setupMobile(),this.width=this.canvas.width,this.height=this.canvas.height,this.ctx=this.canvas.getContext&&this.canvas.getContext("2d"),!this.ctx)return alert("Please upgrade your browser to play");this.setupInput(),this.loop(),this.mobile&&this.setBoard(4,new TouchControls),SpriteSheet.load(e,i)};var e={37:"left",39:"right",32:"fire"};this.keys={},this.setupInput=function(){window.addEventListener("keydown",function(t){e[t.keyCode]&&(Game.keys[e[t.keyCode]]=!0,t.preventDefault())},!1),window.addEventListener("keyup",function(t){e[t.keyCode]&&(Game.keys[e[t.keyCode]]=!1,t.preventDefault())},!1)};var i=(new Date).getTime();this.loop=function(){var e=(new Date).getTime();requestAnimationFrame(Game.loop);var a=(e-i)/1e3;a>1/30&&(a=1/30);for(var n=0,s=t.length;n<s;n++)t[n]&&(t[n].step(a),t[n].draw(Game.ctx));i=e},this.setBoard=function(e,i){t[e]=i},this.setupMobile=function(){var t=document.getElementById("container"),e=!!("ontouchstart"in window),i=window.innerWidth,a=window.innerHeight;if(e&&(this.mobile=!0),screen.width>=1280||!e)return!1;i>a&&(alert("Please rotate the device and then click OK"),i=window.innerWidth,a=window.innerHeight),t.style.height=2*a+"px",window.scrollTo(0,1),a=window.innerHeight+2,t.style.height=a+"px",t.style.width=i+"px",t.style.padding=0,a>=1.75*this.canvas.height||i>=1.75*this.canvas.height?(this.canvasMultiplier=2,this.canvas.width=i/2,this.canvas.height=a/2,this.canvas.style.width=i+"px",this.canvas.style.height=a+"px"):(this.canvas.width=i,this.canvas.height=a),this.canvas.style.position="absolute",this.canvas.style.left="0px",this.canvas.style.top="0px"}},SpriteSheet=new function(){return this.map={},this.load=function(t,e){this.map=t,this.image=new Image,this.image.onload=e,this.image.src="images/sprites.png"},this.draw=function(t,e,i,a,n){var s=this.map[e];n||(n=0),t.drawImage(this.image,s.sx+n*s.w,s.sy,s.w,s.h,Math.floor(i),Math.floor(a),s.w,s.h)},this},TitleScreen=function(t,e,i){var a=!1;this.step=function(t){Game.keys.fire||(a=!0),a&&Game.keys.fire&&i&&i()},this.draw=function(i){i.fillStyle="#FFFFFF",i.font="bold 40px bangers";var a=i.measureText(t);i.fillText(t,Game.width/2-a.width/2,Game.height/2),i.font="bold 20px bangers";var n=i.measureText(e);i.fillText(e,Game.width/2-n.width/2,Game.height/2+40)}},GameBoard=function(){var t=this;this.objects=[],this.cnt={},this.add=function(t){return t.board=this,this.objects.push(t),this.cnt[t.type]=(this.cnt[t.type]||0)+1,t},this.remove=function(t){return-1==this.removed.indexOf(t)&&(this.removed.push(t),!0)},this.resetRemoved=function(){this.removed=[]},this.finalizeRemoved=function(){for(var t=0,e=this.removed.length;t<e;t++){var i=this.objects.indexOf(this.removed[t]);-1!=i&&(this.cnt[this.removed[t].type]--,this.objects.splice(i,1))}},this.iterate=function(t){for(var e=Array.prototype.slice.call(arguments,1),i=0,a=this.objects.length;i<a;i++){var n=this.objects[i];n[t].apply(n,e)}},this.detect=function(t){for(var e=0,i=this.objects.length;e<i;e++)if(t.call(this.objects[e]))return this.objects[e];return!1},this.step=function(t){this.resetRemoved(),this.iterate("step",t),this.finalizeRemoved()},this.draw=function(t){this.iterate("draw",t)},this.overlap=function(t,e){return!(t.y+t.h-1<e.y||t.y>e.y+e.h-1||t.x+t.w-1<e.x||t.x>e.x+e.w-1)},this.collide=function(e,i){return this.detect(function(){if(e!=this)return!!((!i||this.type&i)&&t.overlap(e,this))&&this})}},Sprite=function(){};Sprite.prototype.setup=function(t,e){this.sprite=t,this.merge(e),this.frame=this.frame||0,this.w=SpriteSheet.map[t].w,this.h=SpriteSheet.map[t].h},Sprite.prototype.merge=function(t){if(t)for(var e in t)this[e]=t[e]},Sprite.prototype.draw=function(t){SpriteSheet.draw(t,this.sprite,this.x,this.y,this.frame)},Sprite.prototype.hit=function(t){this.board.remove(this)};var Level=function(t,e){this.levelData=[];for(var i=0;i<t.length;i++)this.levelData.push(Object.create(t[i]));this.t=0,this.callback=e};Level.prototype.step=function(t){var e=0,i=[],a=null;for(this.t+=1e3*t;(a=this.levelData[e])&&a[0]<this.t+2e3;){if(this.t>a[1])i.push(a);else if(a[0]<this.t){var n=enemies[a[3]],s=a[4];this.board.add(new Enemy(n,s)),a[0]+=a[2]}e++}for(var h=0,r=i.length;h<r;h++){var o=this.levelData.indexOf(i[h]);-1!=o&&this.levelData.splice(o,1)}0===this.levelData.length&&0===this.board.cnt[OBJECT_ENEMY]&&this.callback&&this.callback()},Level.prototype.draw=function(t){};var TouchControls=function(){var t=Game.width/5,e=t-10;this.drawSquare=function(i,a,n,s,h){i.globalAlpha=h?.9:.6,i.fillStyle="#CCC",i.fillRect(a,n,e,e),i.fillStyle="#FFF",i.globalAlpha=1,i.font="bold "+3*t/4+"px arial";var r=i.measureText(s);i.fillText(s,a+e/2-r.width/2,n+3*e/4+5)},this.draw=function(e){e.save();var i=Game.height-t;this.drawSquare(e,10,i,"◀",Game.keys.left),this.drawSquare(e,t+10,i,"▶",Game.keys.right),this.drawSquare(e,4*t,i,"A",Game.keys.fire),e.restore()},this.step=function(t){},this.trackTouch=function(e){var i;e.preventDefault(),Game.keys.left=!1,Game.keys.right=!1;for(var a=0;a<e.targetTouches.length;a++)(i=e.targetTouches[a].pageX/Game.canvasMultiplier-Game.canvas.offsetLeft)<t&&(Game.keys.left=!0),i>t&&i<2*t&&(Game.keys.right=!0);if("touchstart"==e.type||"touchend"==e.type)for(a=0;a<e.changedTouches.length;a++)(i=e.changedTouches[a].pageX/Game.canvasMultiplier-Game.canvas.offsetLeft)>4*t&&(Game.keys.fire="touchstart"==e.type)},Game.canvas.addEventListener("touchstart",this.trackTouch,!0),Game.canvas.addEventListener("touchmove",this.trackTouch,!0),Game.canvas.addEventListener("touchend",this.trackTouch,!0),Game.canvas.addEventListener("dblclick",function(t){t.preventDefault()},!0),Game.canvas.addEventListener("click",function(t){t.preventDefault()},!0),Game.playerOffset=t+20},GamePoints=function(){Game.points=0;this.draw=function(t){t.save(),t.font="bold 18px arial",t.fillStyle="#FFFFFF";for(var e=""+Game.points,i=8-e.length,a="";i-- >0;)a+="0";t.fillText(a+e,10,20),t.restore()},this.step=function(t){}};